<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Reshaping - DataFrames.jl</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/github.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">DataFrames.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../getting_started">Introduction</a>
                            </li>
                        
                            <li >
                                <a href="../io">IO</a>
                            </li>
                        
                            <li >
                                <a href="../subsets">Subsetting</a>
                            </li>
                        
                            <li >
                                <a href="../joins_and_indexing">Joins and indexing</a>
                            </li>
                        
                            <li >
                                <a href="../split_apply_combine">Split-apply-combine</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Reshaping</a>
                            </li>
                        
                            <li >
                                <a href="../sorting">Sorting</a>
                            </li>
                        
                            <li >
                                <a href="../formulas">Formulas</a>
                            </li>
                        
                            <li >
                                <a href="../pooling">Pooling</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../api/maintypes">Main types</a>
                            </li>
                        
                            <li >
                                <a href="../api/utilities">Utilities</a>
                            </li>
                        
                            <li >
                                <a href="../api/manipulation">Data manipulation</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../NEWS">Release notes</a>
                            </li>
                        
                            <li >
                                <a href="../LICENSE">License</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../split_apply_combine">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../sorting">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/JuliaStats/DataFrames.jl">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#reshaping-and-pivoting-data">Reshaping and Pivoting Data</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="reshaping-and-pivoting-data">Reshaping and Pivoting Data</h1>
<p>Reshape data from wide to long format using the <code>stack</code> function:</p>
<div class="codehilite"><pre>using DataFrames, RDatasets
iris = dataset(&quot;datasets&quot;, &quot;iris&quot;)
iris[:id] = 1:size(iris, 1)  # this makes it easier to unstack
d = stack(iris, [1:4])
</pre></div>


<p>The second optional argument to <code>stack</code> indicates the columns to be stacked. These are normally referred to as the measured variables. Column names can also be given:</p>
<div class="codehilite"><pre>d = stack(iris, [:SepalLength, :SepalWidth, :PetalLength, :PetalWidth])
</pre></div>


<p>Note that all columns can be of different types. Type promotion follows the rules of <code>vcat</code>.</p>
<p>The stacked DataFrame that results includes all of the columns not specified to be stacked. These are repeated for each stacked column. These are normally refered to as identifier (id) columns. In addition to the id columns, two additional columns labeled <code>:variable</code> and <code>:values</code> contain the column identifier and the stacked columns.</p>
<p>A third optional argument to <code>stack</code> represents the id columns that are repeated. This makes it easier to specify which variables you want included in the long format:</p>
<div class="codehilite"><pre>d = stack(iris, [:SepalLength, :SepalWidth], :Species)
</pre></div>


<p><code>melt</code> is an alternative function to reshape from wide to long format. It is based on <code>stack</code>, but it prefers specification of the id columns as:</p>
<div class="codehilite"><pre>d = melt(iris, :Species)
</pre></div>


<p>All other columns are assumed to be measured variables (they are stacked).</p>
<p>You can also stack an entire DataFrame. The default stacks all floating-point columns:</p>
<div class="codehilite"><pre>d = stack(iris)
</pre></div>


<p><code>unstack</code> converts from a long format to a wide format. The default is requires specifying which columns are an id variable, column variable names, and column values:</p>
<div class="codehilite"><pre>longdf = melt(iris, :id)
widedf = unstack(longdf, :id, :variable, :value)
</pre></div>


<p>If the remaining columns are unique, you can skip the id variable and use:</p>
<div class="codehilite"><pre>widedf = unstack(longdf, :variable, :value)
</pre></div>


<p><code>stackdf</code> and <code>meltdf</code> are two additional functions that work like <code>stack</code> and <code>melt</code>, but they provide a view into the original wide DataFrame. Here is an example:</p>
<div class="codehilite"><pre>d = stackdf(iris)
</pre></div>


<p>This saves memory. To create the view, several AbstractVectors are defined:</p>
<p><code>:variable</code> column -- <code>EachRepeatedVector</code><br />
This repeats the variables N times where N is the number of rows of the original AbstractDataFrame.</p>
<p><code>:value</code> column -- <code>StackedVector</code><br />
This is provides a view of the original columns stacked together.</p>
<p>Id columns -- <code>RepeatedVector</code><br />
This repeats the original columns N times where N is the number of columns stacked.</p>
<p>For more details on the storage representation, see:</p>
<div class="codehilite"><pre>dump(stackdf(iris))
</pre></div>


<p>None of these reshaping functions perform any aggregation. To do aggregation, use the split-apply-combine functions in combination with reshaping. Here is an example:</p>
<div class="codehilite"><pre>d = stack(iris)
x = by(d, [:variable, :Species], df -&gt; DataFrame(vsum = mean(df[:value])))
unstack(x, :Species, :vsum)
</pre></div>


</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>